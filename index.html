<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="color-scheme" content="dark light" />
		<link rel="stylesheet" href="./css/styles.css" media="screen" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WebGL Logo</title>
		<script src="js/twgl-full.js"></script>
		<script id="vs" src="js/shaders/vertex.glsl" type="notjs"></script>
		<script id="fs" src="js/shaders/fragment.glsl" type="notjs"></script>
	</head>
	<body>
		<canvas id="c"></canvas>
		<script type="module">
			// Load shaders
			const shaders = [
				...document.querySelectorAll('[src][type="notjs"]'),
			];
			const promises = shaders.map((shader) => {
				return fetch(shader.src)
					.then((res) => res.text())
					.then((text) => {
						shader.text = text;
					});
			});
			await Promise.all(promises);

			// Init WebGL/TWGL
			const gl = document.getElementById('c').getContext('webgl');
			const programInfo = twgl.createProgramInfo(gl, ['vs', 'fs']);

			const arrays = {
				position: [
					[-1, -1, 0],
					[1, -1, 0],
					[-1, 1, 0],
					[-1, 1, 0],
					[1, -1, 0],
					[1, 1, 0],
				].flat(),
			};
			const bufferInfo = twgl.createBufferInfoFromArrays(gl, arrays);

			function render(time) {
				twgl.resizeCanvasToDisplaySize(gl.canvas);
				gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

				const uniforms = {
					u_time: time * 0.001,
					u_resolution: [gl.canvas.width, gl.canvas.height],
				};

				gl.useProgram(programInfo.program);
				twgl.setBuffersAndAttributes(gl, programInfo, bufferInfo);
				twgl.setUniforms(programInfo, uniforms);
				twgl.drawBufferInfo(gl, bufferInfo);

				// requestAnimationFrame(render);
			}
			requestAnimationFrame(render);
		</script>
	</body>
</html>
